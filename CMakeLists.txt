cmake_minimum_required(VERSION 2.6)
project(t01)

option(USE_JEMALLOC "used jemalloc as replacement for libc malloc" ON) 
set(CMAKE_BUILD_TYPE Release)

include_directories( "./" )
include_directories( "./3rd/include/netmap/" )
include_directories( "./3rd/include/cJSON/" )
include_directories( "./3rd/include/ndpi/" )
include_directories( "./3rd/include/hiredis/" )
include_directories( "./3rd/include/rdkafka/" )
include_directories( "./3rd/include/msgpack/" )
include_directories( "./3rd/include/http-parser/" )
include_directories( "./3rd/include/libevent/" )
include_directories( "./3rd/include/mysql/" )
include_directories( "./3rd/include/" )
include_directories( "./3rd/include/pcap/" )
set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -Wformat=0")

if (USE_JEMALLOC)
add_definitions(-DUSE_JEMALLOC)
include_directories( "./3rd/include/jemalloc/" )
set(EXTRA_LIBS ${EXTRA_LIBS} ${PROJECT_SOURCE_DIR}/3rd/lib/libjemalloc.a dl pthread)
endif (USE_JEMALLOC)

SET(THIRD_SRC_DIR 3rd/src/)
SET(CJSON_SRC_DIR ${THIRD_SRC_DIR}/cJSON)
SET(THIRD_SRC ${CJSON_SRC_DIR}/cJSON.c)

add_executable(t01 logger.c t01.c zmalloc.c ndpi_util.c lfq.c pktgen.c rule.c crc64.c util.c anet.c http-server.c ioengines.c engines/redis.c engines/kafka.c engines/netmap.c ${THIRD_SRC})
target_link_libraries(t01 m pthread)
target_link_libraries(t01 ${PROJECT_SOURCE_DIR}/3rd/lib/libndpi.a)
target_link_libraries(t01 ${PROJECT_SOURCE_DIR}/3rd/lib/libhiredis.a)
target_link_libraries(t01 ${PROJECT_SOURCE_DIR}/3rd/lib/librdkafka.a)
target_link_libraries(t01 ${PROJECT_SOURCE_DIR}/3rd/lib/libevent.a)
target_link_libraries(t01 z)
target_link_libraries(t01 ${PROJECT_SOURCE_DIR}/3rd/lib/libmsgpackc.a)
target_link_libraries(t01 ${PROJECT_SOURCE_DIR}/3rd/lib/libpfring.a)
target_link_libraries(t01 ${PROJECT_SOURCE_DIR}/3rd/lib/libpcap.a)
target_link_libraries(t01 ${EXTRA_LIBS})

add_executable(tests_rule tests/tests_rule.c logger.c zmalloc.c rule.c crc64.c util.c ${THIRD_SRC})
target_link_libraries(tests_rule m pthread)
target_link_libraries(tests_rule ${PROJECT_SOURCE_DIR}/3rd/lib/libevent.a)
target_link_libraries(tests_rule z)
target_link_libraries(tests_rule ${EXTRA_LIBS})

add_executable(t01log t01log.c anet.c queue.c queue_internal.c logger.c util.c zmalloc.c)
target_link_libraries(t01log ${PROJECT_SOURCE_DIR}/3rd/lib/libevent.a)
target_link_libraries(t01log m pthread)
target_link_libraries(t01log ${EXTRA_LIBS})
target_link_libraries(t01log ${PROJECT_SOURCE_DIR}/3rd/lib/libmysqlclient.a)
target_link_libraries(t01log z m)

